{"version":3,"names":["isHook","isBuiltInHook","_default","types","t","visitor","CallExpression","path","state","onlyBuiltIns","opts","libs","lib","concat","isVariableDeclarator","parent","isArrayPattern","id","hookName","node","callee","name","binding","scope","getBinding","kind","specifier","source","value","some","test","objectPattern","elements","reduce","patterns","element","i","objectProperty","numericLiteral","Program","traverse"],"sources":["optimize-hook-destructuring.ts"],"sourcesContent":["import { PluginObj } from '@babel/core'\nimport { NodePath } from '@babel/traverse'\nimport * as BabelTypes from '@babel/types'\n\n// matches any hook-like (the default)\nconst isHook = /^use[A-Z]/\n\n// matches only built-in hooks provided by React et al\nconst isBuiltInHook = /^use(Callback|Context|DebugValue|Effect|ImperativeHandle|LayoutEffect|Memo|Reducer|Ref|State)$/\n\nexport default function({\n  types: t,\n}: {\n  types: typeof BabelTypes\n}): PluginObj<any> {\n  const visitor = {\n    CallExpression(path: NodePath<BabelTypes.CallExpression>, state: any) {\n      const onlyBuiltIns = state.opts.onlyBuiltIns\n\n      // if specified, options.lib is a list of libraries that provide hook functions\n      const libs =\n        state.opts.lib &&\n        (state.opts.lib === true\n          ? ['react', 'preact/hooks']\n          : [].concat(state.opts.lib))\n\n      // skip function calls that are not the init of a variable declaration:\n      if (!t.isVariableDeclarator(path.parent)) return\n\n      // skip function calls where the return value is not Array-destructured:\n      if (!t.isArrayPattern(path.parent.id)) return\n\n      // name of the (hook) function being called:\n      const hookName = (path.node.callee as BabelTypes.Identifier).name\n\n      if (libs) {\n        const binding = path.scope.getBinding(hookName)\n        // not an import\n        if (!binding || binding.kind !== 'module') return\n\n        const specifier = (binding.path.parent as BabelTypes.ImportDeclaration)\n          .source.value\n        // not a match\n        if (!libs.some(lib => lib === specifier)) return\n      }\n\n      // only match function calls with names that look like a hook\n      if (!(onlyBuiltIns ? isBuiltInHook : isHook).test(hookName)) return\n\n      path.parent.id = t.objectPattern(\n        path.parent.id.elements.reduce<Array<BabelTypes.ObjectProperty>>(\n          (patterns, element, i) => {\n            if (element === null) {\n              return patterns\n            }\n\n            return patterns.concat(\n              t.objectProperty(t.numericLiteral(i), element)\n            )\n          },\n          []\n        )\n      )\n    },\n  }\n\n  return {\n    name: 'optimize-hook-destructuring',\n    visitor: {\n      // this is a workaround to run before preset-env destroys destructured assignments\n      Program(path, state) {\n        path.traverse(visitor, state)\n      },\n    },\n  }\n}\n"],"mappings":"8DAIA;AACA,KAAM,CAAAA,MAAM,CAAG,WAAW,CAE1B;AACA,KAAM,CAAAC,aAAa,CAAG,gGAAgG,CAEvG,SAAAC,SAAS,CACtBC,KAAK,CAAEC,CAGT,CAAC,CAAkB,CACjB,KAAM,CAAAC,OAAO,CAAG,CACdC,cAAcA,CAACC,IAAyC,CAAEC,KAAU,CAAE,CACpE,KAAM,CAAAC,YAAY,CAAGD,KAAK,CAACE,IAAI,CAACD,YAAY,CAE5C;AACA,KAAM,CAAAE,IAAI,CACRH,KAAK,CAACE,IAAI,CAACE,GAAG,GACbJ,KAAK,CAACE,IAAI,CAACE,GAAG,GAAK,IAAI,CACpB,CAAC,OAAO,CAAE,cAAc,CAAC,CACzB,EAAE,CAACC,MAAM,CAACL,KAAK,CAACE,IAAI,CAACE,GAAG,CAAC,CAAC,CAEhC;AACA,GAAI,CAACR,CAAC,CAACU,oBAAoB,CAACP,IAAI,CAACQ,MAAM,CAAC,CAAE,OAE1C;AACA,GAAI,CAACX,CAAC,CAACY,cAAc,CAACT,IAAI,CAACQ,MAAM,CAACE,EAAE,CAAC,CAAE,OAEvC;AACA,KAAM,CAAAC,QAAQ,CAAIX,IAAI,CAACY,IAAI,CAACC,MAAM,CAA2BC,IAAI,CAEjE,GAAIV,IAAI,CAAE,CACR,KAAM,CAAAW,OAAO,CAAGf,IAAI,CAACgB,KAAK,CAACC,UAAU,CAACN,QAAQ,CAAC,CAC/C;AACA,GAAI,CAACI,OAAO,EAAIA,OAAO,CAACG,IAAI,GAAK,QAAQ,CAAE,OAE3C,KAAM,CAAAC,SAAS,CAAIJ,OAAO,CAACf,IAAI,CAACQ,MAAM,CACnCY,MAAM,CAACC,KAAK,CACf;AACA,GAAI,CAACjB,IAAI,CAACkB,IAAI,CAACjB,GAAG,EAAIA,GAAG,GAAKc,SAAS,CAAC,CAAE,OAC5C,CAEA;AACA,GAAI,CAAC,CAACjB,YAAY,CAAGR,aAAa,CAAGD,MAAM,EAAE8B,IAAI,CAACZ,QAAQ,CAAC,CAAE,OAE7DX,IAAI,CAACQ,MAAM,CAACE,EAAE,CAAGb,CAAC,CAAC2B,aAAa,CAC9BxB,IAAI,CAACQ,MAAM,CAACE,EAAE,CAACe,QAAQ,CAACC,MAAM,CAC5B,CAACC,QAAQ,CAAEC,OAAO,CAAEC,CAAC,GAAK,CACxB,GAAID,OAAO,GAAK,IAAI,CAAE,CACpB,MAAO,CAAAD,QAAQ,CACjB,CAEA,MAAO,CAAAA,QAAQ,CAACrB,MAAM,CACpBT,CAAC,CAACiC,cAAc,CAACjC,CAAC,CAACkC,cAAc,CAACF,CAAC,CAAC,CAAED,OAAO,CAC/C,CAAC,CACH,CAAC,CACD,EACF,CACF,CAAC,CACH,CACF,CAAC,CAED,MAAO,CACLd,IAAI,CAAE,6BAA6B,CACnChB,OAAO,CAAE,CACP;AACAkC,OAAOA,CAAChC,IAAI,CAAEC,KAAK,CAAE,CACnBD,IAAI,CAACiC,QAAQ,CAACnC,OAAO,CAAEG,KAAK,CAAC,CAC/B,CACF,CACF,CAAC,CACH","ignoreList":[]}