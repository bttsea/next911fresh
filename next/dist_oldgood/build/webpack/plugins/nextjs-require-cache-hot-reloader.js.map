{"version":3,"names":["_fs","require","deleteCache","path","cache","realpathSync","e","code","NextJsRequireCacheHotReloader","constructor","prevAssets","apply","compiler","hooks","afterEmit","tapAsync","compilation","callback","assets","f","Object","keys","existsAt","exports"],"sources":["nextjs-require-cache-hot-reloader.ts"],"sourcesContent":["import { Compiler, Plugin } from 'webpack'\nimport { realpathSync } from 'fs'\n\nfunction deleteCache(path: string) {\n  try {\n    delete require.cache[realpathSync(path)]\n  } catch (e) {\n    if (e.code !== 'ENOENT') throw e\n  } finally {\n    delete require.cache[path]\n  }\n}\n\n// This plugin flushes require.cache after emitting the files. Providing 'hot reloading' of server files.\nexport class NextJsRequireCacheHotReloader implements Plugin {\n  prevAssets: any = null\n\n  apply(compiler: Compiler) {\n    compiler.hooks.afterEmit.tapAsync(\n      'NextJsRequireCacheHotReloader',\n      (compilation, callback) => {\n        const { assets } = compilation\n\n        if (this.prevAssets) {\n          for (const f of Object.keys(assets)) {\n            deleteCache(assets[f].existsAt)\n          }\n          for (const f of Object.keys(this.prevAssets)) {\n            if (!assets[f]) {\n              deleteCache(this.prevAssets[f].existsAt)\n            }\n          }\n        }\n        this.prevAssets = assets\n\n        callback()\n      }\n    )\n  }\n}\n"],"mappings":"kFACA,IAAAA,GAAA,CAAAC,OAAA,OAEA,QAAS,CAAAC,WAAWA,CAACC,IAAY,CAAE,CACjC,GAAI,CACF,MAAO,CAAAF,OAAO,CAACG,KAAK,CAAC,GAAAC,gBAAY,EAACF,IAAI,CAAC,CAAC,CAC1C,CAAE,MAAOG,CAAC,CAAE,CACV,GAAIA,CAAC,CAACC,IAAI,GAAK,QAAQ,CAAE,KAAM,CAAAD,CAAC,CAClC,CAAC,OAAS,CACR,MAAO,CAAAL,OAAO,CAACG,KAAK,CAACD,IAAI,CAAC,CAC5B,CACF,CAEA;AACO,KAAM,CAAAK,6BAAgD,CAAAC,YAAA,OAC3DC,UAAU,CAAQ,IAAI,EAEtBC,KAAKA,CAACC,QAAkB,CAAE,CACxBA,QAAQ,CAACC,KAAK,CAACC,SAAS,CAACC,QAAQ,CAC/B,+BAA+B,CAC/B,CAACC,WAAW,CAAEC,QAAQ,GAAK,CACzB,KAAM,CAAEC,MAAO,CAAC,CAAGF,WAAW,CAE9B,GAAI,IAAI,CAACN,UAAU,CAAE,CACnB,IAAK,KAAM,CAAAS,CAAC,GAAI,CAAAC,MAAM,CAACC,IAAI,CAACH,MAAM,CAAC,CAAE,CACnChB,WAAW,CAACgB,MAAM,CAACC,CAAC,CAAC,CAACG,QAAQ,CAAC,CACjC,CACA,IAAK,KAAM,CAAAH,CAAC,GAAI,CAAAC,MAAM,CAACC,IAAI,CAAC,IAAI,CAACX,UAAU,CAAC,CAAE,CAC5C,GAAI,CAACQ,MAAM,CAACC,CAAC,CAAC,CAAE,CACdjB,WAAW,CAAC,IAAI,CAACQ,UAAU,CAACS,CAAC,CAAC,CAACG,QAAQ,CAAC,CAC1C,CACF,CACF,CACA,IAAI,CAACZ,UAAU,CAAGQ,MAAM,CAExBD,QAAQ,CAAC,CAAC,CACZ,CACF,CAAC,CACH,CACF,CAACM,OAAA,CAAAf,6BAAA,CAAAA,6BAAA","ignoreList":[]}