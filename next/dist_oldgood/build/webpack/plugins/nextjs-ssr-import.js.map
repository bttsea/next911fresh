{"version":3,"names":["_path","require","NextJsSsrImportPlugin","apply","compiler","hooks","compilation","tap","mainTemplate","requireEnsure","code","chunk","outputPath","resolve","pagePath","join","dirname","name","relativePathToBaseDir","relative","relativePathToBaseDirNormalized","replace","exports","default"],"sources":["nextjs-ssr-import.ts"],"sourcesContent":["import { join, resolve, relative, dirname } from 'path'\nimport { Compiler } from 'webpack'\n\n// This plugin modifies the require-ensure code generated by Webpack\n// to work with Next.js SSR\nexport default class NextJsSsrImportPlugin {\n  apply(compiler: Compiler) {\n    compiler.hooks.compilation.tap('NextJsSSRImport', (compilation: any) => {\n      compilation.mainTemplate.hooks.requireEnsure.tap(\n        'NextJsSSRImport',\n        (code: string, chunk: any) => {\n          // Update to load chunks from our custom chunks directory\n          const outputPath = resolve('/')\n          const pagePath = join('/', dirname(chunk.name))\n          const relativePathToBaseDir = relative(pagePath, outputPath)\n          // Make sure even in windows, the path looks like in unix\n          // Node.js require system will convert it accordingly\n          const relativePathToBaseDirNormalized = relativePathToBaseDir.replace(\n            /\\\\/g,\n            '/'\n          )\n          return code\n            .replace(\n              'require(\"./\"',\n              `require(\"${relativePathToBaseDirNormalized}/\"`\n            )\n            .replace(\n              'readFile(join(__dirname',\n              `readFile(join(__dirname, \"${relativePathToBaseDirNormalized}\"`\n            )\n        }\n      )\n    })\n  }\n}\n"],"mappings":"4DAAA,IAAAA,KAAA,CAAAC,OAAA,SAGA;AACA;AACe,KAAM,CAAAC,qBAAsB,CACzCC,KAAKA,CAACC,QAAkB,CAAE,CACxBA,QAAQ,CAACC,KAAK,CAACC,WAAW,CAACC,GAAG,CAAC,iBAAiB,CAAGD,WAAgB,EAAK,CACtEA,WAAW,CAACE,YAAY,CAACH,KAAK,CAACI,aAAa,CAACF,GAAG,CAC9C,iBAAiB,CACjB,CAACG,IAAY,CAAEC,KAAU,GAAK,CAC5B;AACA,KAAM,CAAAC,UAAU,CAAG,GAAAC,aAAO,EAAC,GAAG,CAAC,CAC/B,KAAM,CAAAC,QAAQ,CAAG,GAAAC,UAAI,EAAC,GAAG,CAAE,GAAAC,aAAO,EAACL,KAAK,CAACM,IAAI,CAAC,CAAC,CAC/C,KAAM,CAAAC,qBAAqB,CAAG,GAAAC,cAAQ,EAACL,QAAQ,CAAEF,UAAU,CAAC,CAC5D;AACA;AACA,KAAM,CAAAQ,+BAA+B,CAAGF,qBAAqB,CAACG,OAAO,CACnE,KAAK,CACL,GACF,CAAC,CACD,MAAO,CAAAX,IAAI,CACRW,OAAO,CACN,cAAc,CACd,YAAYD,+BAA+B,IAC7C,CAAC,CACAC,OAAO,CACN,yBAAyB,CACzB,6BAA6BD,+BAA+B,GAC9D,CAAC,CACL,CACF,CAAC,CACH,CAAC,CAAC,CACJ,CACF,CAACE,OAAA,CAAAC,OAAA,CAAArB,qBAAA","ignoreList":[]}