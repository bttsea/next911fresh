{"version":3,"names":["_webpackSources","require","_constants","PagesManifestPlugin","constructor","serverless","apply","compiler","hooks","emit","tap","compilation","chunks","pages","chunk","result","SERVERLESS_ROUTE_NAME_REGEX","ROUTE_NAME_REGEX","exec","name","pagePath","replace","assets","PAGES_MANIFEST","RawSource","JSON","stringify","exports","default"],"sources":["pages-manifest-plugin.ts"],"sourcesContent":["import { Compiler, Plugin } from 'webpack'\nimport { RawSource } from 'webpack-sources'\nimport {\n  PAGES_MANIFEST,\n  ROUTE_NAME_REGEX,\n  SERVERLESS_ROUTE_NAME_REGEX,\n} from '../../../next-server/lib/constants'\n\n// This plugin creates a pages-manifest.json from page entrypoints.\n// This is used for mapping paths like `/` to `.next/server/static/<buildid>/pages/index.js` when doing SSR\n// It's also used by next export to provide defaultPathMap\nexport default class PagesManifestPlugin implements Plugin {\n  serverless: boolean\n\n  constructor(serverless: boolean) {\n    this.serverless = serverless\n  }\n\n  apply(compiler: Compiler): void {\n    compiler.hooks.emit.tap('NextJsPagesManifest', compilation => {\n      const { chunks } = compilation\n      const pages: { [page: string]: string } = {}\n\n      for (const chunk of chunks) {\n        const result = (this.serverless\n          ? SERVERLESS_ROUTE_NAME_REGEX\n          : ROUTE_NAME_REGEX\n        ).exec(chunk.name)\n\n        if (!result) {\n          continue\n        }\n\n        const pagePath = result[1]\n\n        if (!pagePath) {\n          continue\n        }\n\n        // Write filename, replace any backslashes in path (on windows) with forwardslashes for cross-platform consistency.\n        pages[`/${pagePath.replace(/\\\\/g, '/')}`] = chunk.name.replace(\n          /\\\\/g,\n          '/'\n        )\n      }\n\n      if (typeof pages['/index'] !== 'undefined') {\n        pages['/'] = pages['/index']\n      }\n\n      compilation.assets[PAGES_MANIFEST] = new RawSource(JSON.stringify(pages))\n    })\n  }\n}\n"],"mappings":"4DACA,IAAAA,eAAA,CAAAC,OAAA,oBACA,IAAAC,UAAA,CAAAD,OAAA,uCAMA;AACA;AACA;AACe,KAAM,CAAAE,mBAAsC,CAGzDC,WAAWA,CAACC,UAAmB,CAAE,MAFjCA,UAAU,QAGR,IAAI,CAACA,UAAU,CAAGA,UAAU,CAC9B,CAEAC,KAAKA,CAACC,QAAkB,CAAQ,CAC9BA,QAAQ,CAACC,KAAK,CAACC,IAAI,CAACC,GAAG,CAAC,qBAAqB,CAAEC,WAAW,EAAI,CAC5D,KAAM,CAAEC,MAAO,CAAC,CAAGD,WAAW,CAC9B,KAAM,CAAAE,KAAiC,CAAG,CAAC,CAAC,CAE5C,IAAK,KAAM,CAAAC,KAAK,GAAI,CAAAF,MAAM,CAAE,CAC1B,KAAM,CAAAG,MAAM,CAAG,CAAC,IAAI,CAACV,UAAU,CAC3BW,sCAA2B,CAC3BC,2BAAgB,EAClBC,IAAI,CAACJ,KAAK,CAACK,IAAI,CAAC,CAElB,GAAI,CAACJ,MAAM,CAAE,CACX,SACF,CAEA,KAAM,CAAAK,QAAQ,CAAGL,MAAM,CAAC,CAAC,CAAC,CAE1B,GAAI,CAACK,QAAQ,CAAE,CACb,SACF,CAEA;AACAP,KAAK,CAAC,IAAIO,QAAQ,CAACC,OAAO,CAAC,KAAK,CAAE,GAAG,CAAC,EAAE,CAAC,CAAGP,KAAK,CAACK,IAAI,CAACE,OAAO,CAC5D,KAAK,CACL,GACF,CAAC,CACH,CAEA,GAAI,MAAO,CAAAR,KAAK,CAAC,QAAQ,CAAC,GAAK,WAAW,CAAE,CAC1CA,KAAK,CAAC,GAAG,CAAC,CAAGA,KAAK,CAAC,QAAQ,CAAC,CAC9B,CAEAF,WAAW,CAACW,MAAM,CAACC,yBAAc,CAAC,CAAG,GAAI,CAAAC,yBAAS,CAACC,IAAI,CAACC,SAAS,CAACb,KAAK,CAAC,CAAC,CAC3E,CAAC,CAAC,CACJ,CACF,CAACc,OAAA,CAAAC,OAAA,CAAAzB,mBAAA","ignoreList":[]}