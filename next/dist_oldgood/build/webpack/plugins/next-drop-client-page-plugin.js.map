{"version":3,"names":["_path","require","DropClientPage","constructor","ampPages","Set","apply","compiler","hooks","emit","tap","compilation","Object","keys","assets","forEach","assetKey","asset","_value","includes","cleanAssetKey","replace","page","split","pageNoExt","extname","endsWith","add","exports"],"sources":["next-drop-client-page-plugin.ts"],"sourcesContent":["import { Compiler, Plugin } from 'webpack'\nimport { extname } from 'path'\n\n// Prevents outputting client pages when they are not needed\nexport class DropClientPage implements Plugin {\n  ampPages = new Set()\n\n  apply(compiler: Compiler) {\n    compiler.hooks.emit.tap('DropClientPage', compilation => {\n      Object.keys(compilation.assets).forEach(assetKey => {\n        const asset = compilation.assets[assetKey]\n\n        if (\n          asset &&\n          asset._value &&\n          asset._value.includes('__NEXT_DROP_CLIENT_FILE__')\n        ) {\n          const cleanAssetKey = assetKey.replace(/\\\\/g, '/')\n          const page = '/' + cleanAssetKey.split('pages/')[1]\n          const pageNoExt = page.split(extname(page))[0]\n\n          delete compilation.assets[assetKey]\n\n          // Detect being re-ran through a child compiler and don't re-mark the\n          // page as AMP\n          if (!pageNoExt.endsWith('.module')) {\n            this.ampPages.add(pageNoExt.replace(/\\/index$/, '') || '/')\n          }\n        }\n      })\n    })\n  }\n}\n"],"mappings":"mEACA,IAAAA,KAAA,CAAAC,OAAA,SAEA;AACO,KAAM,CAAAC,cAAiC,CAAAC,YAAA,OAC5CC,QAAQ,CAAG,GAAI,CAAAC,GAAG,CAAC,CAAC,EAEpBC,KAAKA,CAACC,QAAkB,CAAE,CACxBA,QAAQ,CAACC,KAAK,CAACC,IAAI,CAACC,GAAG,CAAC,gBAAgB,CAAEC,WAAW,EAAI,CACvDC,MAAM,CAACC,IAAI,CAACF,WAAW,CAACG,MAAM,CAAC,CAACC,OAAO,CAACC,QAAQ,EAAI,CAClD,KAAM,CAAAC,KAAK,CAAGN,WAAW,CAACG,MAAM,CAACE,QAAQ,CAAC,CAE1C,GACEC,KAAK,EACLA,KAAK,CAACC,MAAM,EACZD,KAAK,CAACC,MAAM,CAACC,QAAQ,CAAC,2BAA2B,CAAC,CAClD,CACA,KAAM,CAAAC,aAAa,CAAGJ,QAAQ,CAACK,OAAO,CAAC,KAAK,CAAE,GAAG,CAAC,CAClD,KAAM,CAAAC,IAAI,CAAG,GAAG,CAAGF,aAAa,CAACG,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CACnD,KAAM,CAAAC,SAAS,CAAGF,IAAI,CAACC,KAAK,CAAC,GAAAE,aAAO,EAACH,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAE9C,MAAO,CAAAX,WAAW,CAACG,MAAM,CAACE,QAAQ,CAAC,CAEnC;AACA;AACA,GAAI,CAACQ,SAAS,CAACE,QAAQ,CAAC,SAAS,CAAC,CAAE,CAClC,IAAI,CAACtB,QAAQ,CAACuB,GAAG,CAACH,SAAS,CAACH,OAAO,CAAC,UAAU,CAAE,EAAE,CAAC,EAAI,GAAG,CAAC,CAC7D,CACF,CACF,CAAC,CAAC,CACJ,CAAC,CAAC,CACJ,CACF,CAACO,OAAA,CAAA1B,cAAA,CAAAA,cAAA","ignoreList":[]}