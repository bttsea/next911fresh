{"version":3,"names":["_unistore","_interopRequireDefault","require","_stripAnsi","Log","_interopRequireWildcard","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","store","exports","createStore","appUrl","bootstrap","lastStore","hasStoreChanged","nextStore","Set","keys","every","key","is","subscribe","state","wait","info","loading","errors","error","cleanError","stripAnsi","indexOf","matches","match","prop","split","shift","substr","console","log","warnings","warn","join","typeChecking","ready"],"sources":["store.ts"],"sourcesContent":["import createStore from 'next/dist/compiled/unistore'\nimport stripAnsi from 'strip-ansi'\n\nimport * as Log from './log'\n\nexport type OutputState =\n  | { bootstrap: true; appUrl: string | null }\n  | ({ bootstrap: false; appUrl: string | null } & (\n      | { loading: true }\n      | {\n          loading: false\n          typeChecking: boolean\n          errors: string[] | null\n          warnings: string[] | null\n        }\n    ))\n\nexport const store = createStore<OutputState>({ appUrl: null, bootstrap: true })\n\nlet lastStore: OutputState = {} as any\nfunction hasStoreChanged(nextStore: OutputState) {\n  if (\n    [...new Set([...Object.keys(lastStore), ...Object.keys(nextStore)])].every(\n      key => Object.is((lastStore as any)[key], (nextStore as any)[key])\n    )\n  ) {\n    return false\n  }\n\n  lastStore = nextStore\n  return true\n}\n\nstore.subscribe(state => {\n  if (!hasStoreChanged(state)) {\n    return\n  }\n\n  if (state.bootstrap) {\n    Log.wait('starting the development server ...')\n    if (state.appUrl) {\n      Log.info(`waiting on ${state.appUrl} ...`)\n    }\n    return\n  }\n\n  if (state.loading) {\n    Log.wait('compiling ...')\n    return\n  }\n\n  if (state.errors) {\n    Log.error(state.errors[0])\n\n    const cleanError = stripAnsi(state.errors[0])\n    if (cleanError.indexOf('SyntaxError') > -1) {\n      const matches = cleanError.match(/\\[.*\\]=/)\n      if (matches) {\n        for (const match of matches) {\n          const prop = (match.split(']').shift() || '').substr(1)\n          console.log(\n            `AMP bind syntax [${prop}]='' is not supported in JSX, use 'data-amp-bind-${prop}' instead. https://err.sh/zeit/next.js/amp-bind-jsx-alt`\n          )\n        }\n        return\n      }\n    }\n\n    return\n  }\n\n  if (state.warnings) {\n    Log.warn(state.warnings.join('\\n\\n'))\n    if (state.appUrl) {\n      Log.info(`ready on ${state.appUrl}`)\n    }\n    return\n  }\n\n  if (state.typeChecking) {\n    Log.info('bundled successfully, waiting for typecheck results ...')\n    return\n  }\n\n  Log.ready(\n    'compiled successfully' +\n      (state.appUrl ? ` - ready on ${state.appUrl}` : '')\n  )\n})\n"],"mappings":"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","ignoreList":[]}