{"version":3,"names":["_amphtmlValidator","_interopRequireDefault","require","_fs","_path","_react","_util","_watchpack","_index","Log","_interopRequireWildcard","_constants","_findPagesDir","_verifyTypeScriptSetup","_constants2","_utils","_nextServer","_normalizePagePath","_router","_events","_storage","_errorDebug","_hotReloader","_findPageFile","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","React","Suspense","Error","fsStat","promisify","fs","stat","DevServer","Server","constructor","options","dev","devReady","setDevReady","webpackWatcher","hotReloader","renderOpts","ErrorDebug","Promise","resolve","ampValidator","html","pathname","AmpHtmlValidator","getInstance","then","validator","result","validateString","ampValidation","errors","filter","severity","_filterAmpDevelopmentScript","existsSync","join","dir","console","warn","pagesDir","findPagesDir","currentPhase","PHASE_DEVELOPMENT_SERVER","readBuildId","addExportPathMapRoutes","nextConfig","exportPathMap","log","outDir","distDir","buildId","path","page","query","router","add","match","route","fn","req","res","params","parsedUrl","urlQuery","keys","key","undefined","forEach","mergedQuery","render","startWatcher","resolved","readdir","_","files","length","wp","Watchpack","watch","on","dynamicRoutedPages","knownFiles","getTimeInfoEntries","fileName","accuracy","pageName","relative","replace","RegExp","pageExtensions","isDynamicRoute","push","dynamicRoutes","getSortedRoutes","map","getRouteMatcher","getRouteRegex","stopWatcher","close","prepare","verifyTypeScriptSetup","HotReloader","config","start","setTelemetryDir","recordVersion","cliCommand","stop","run","startsWith","publicDir","PUBLIC_DIR_MIDDLEWARE_CONFLICT","err","hasPublicFile","pageFile","findPageFile","normalizePagePath","statusCode","renderError","servePublic","finished","generateRoutes","routes","unshift","p","serveStatic","generatePublicRoutes","getDynamicRoutes","event","code","snippetChunks","split","snippet","line","substring","col","slice","indexOf","includes","resolveApiRequest","ensurePage","resolvedPath","renderToHTML","compilationErr","getCompilationError","renderErrorToHTML","catch","dynamicRoute","assign","quiet","error","out","err2","sendHTML","setHeader","setImmutableAssetCacheControl","info","isFile","getCompilationErrors","exports"],"sources":["next-dev-server.ts"],"sourcesContent":["import AmpHtmlValidator from 'amphtml-validator'\nimport fs from 'fs'\nimport { IncomingMessage, ServerResponse } from 'http'\nimport { join, relative } from 'path'\nimport React from 'react'\nimport { UrlWithParsedQuery } from 'url'\nimport { promisify } from 'util'\nimport Watchpack from 'watchpack'\n\nimport { ampValidation } from '../build/output/index'\nimport * as Log from '../build/output/log'\nimport { PUBLIC_DIR_MIDDLEWARE_CONFLICT } from '../lib/constants'\nimport { findPagesDir } from '../lib/find-pages-dir'\nimport { verifyTypeScriptSetup } from '../lib/verifyTypeScriptSetup'\nimport { PHASE_DEVELOPMENT_SERVER } from '../next-server/lib/constants'\nimport {\n  getRouteMatcher,\n  getRouteRegex,\n  getSortedRoutes,\n  isDynamicRoute,\n} from '../next-server/lib/router/utils'\nimport Server, { ServerConstructor } from '../next-server/server/next-server'\nimport { normalizePagePath } from '../next-server/server/normalize-page-path'\nimport { route } from '../next-server/server/router'\nimport { recordVersion } from '../telemetry/events'\nimport { setDistDir as setTelemetryDir } from '../telemetry/storage'\nimport ErrorDebug from './error-debug'\nimport HotReloader from './hot-reloader'\nimport { findPageFile } from './lib/find-page-file'\n\nif (typeof React.Suspense === 'undefined') {\n  throw new Error(\n    `The version of React you are using is lower than the minimum required version needed for Next.js. Please upgrade \"react\" and \"react-dom\": \"npm install --save react react-dom\" https://err.sh/zeit/next.js/invalid-react-version`\n  )\n}\n\nconst fsStat = promisify(fs.stat)\n\nexport default class DevServer extends Server {\n  private devReady: Promise<void>\n  private setDevReady?: Function\n  private webpackWatcher?: Watchpack | null\n  private hotReloader?: HotReloader\n\n  constructor(options: ServerConstructor) {\n    super({ ...options, dev: true })\n    this.renderOpts.dev = true\n    ;(this.renderOpts as any).ErrorDebug = ErrorDebug\n    this.devReady = new Promise(resolve => {\n      this.setDevReady = resolve\n    })\n    ;(this.renderOpts as any).ampValidator = (\n      html: string,\n      pathname: string\n    ) => {\n      return AmpHtmlValidator.getInstance().then(validator => {\n        const result = validator.validateString(html)\n        ampValidation(\n          pathname,\n          result.errors\n            .filter(e => e.severity === 'ERROR')\n            .filter(e => this._filterAmpDevelopmentScript(html, e)),\n          result.errors.filter(e => e.severity !== 'ERROR')\n        )\n      })\n    }\n    if (fs.existsSync(join(this.dir, 'static'))) {\n      console.warn(\n        `The static directory has been deprecated in favor of the public directory. https://err.sh/zeit/next.js/static-dir-deprecated`\n      )\n    }\n    this.pagesDir = findPagesDir(this.dir)\n  }\n\n  protected currentPhase() {\n    return PHASE_DEVELOPMENT_SERVER\n  }\n\n  protected readBuildId() {\n    return 'development'\n  }\n\n  async addExportPathMapRoutes() {\n    // Makes `next export` exportPathMap work in development mode.\n    // So that the user doesn't have to define a custom server reading the exportPathMap\n    if (this.nextConfig.exportPathMap) {\n      console.log('Defining routes from exportPathMap')\n      const exportPathMap = await this.nextConfig.exportPathMap(\n        {},\n        {\n          dev: true,\n          dir: this.dir,\n          outDir: null,\n          distDir: this.distDir,\n          buildId: this.buildId,\n        }\n      ) // In development we can't give a default path mapping\n      for (const path in exportPathMap) {\n        const { page, query = {} } = exportPathMap[path]\n\n        // We use unshift so that we're sure the routes is defined before Next's default routes\n        this.router.add({\n          match: route(path),\n          fn: async (req, res, params, parsedUrl) => {\n            const { query: urlQuery } = parsedUrl\n\n            Object.keys(urlQuery)\n              .filter(key => query[key] === undefined)\n              .forEach(key =>\n                console.warn(\n                  `Url '${path}' defines a query parameter '${key}' that is missing in exportPathMap`\n                )\n              )\n\n            const mergedQuery = { ...urlQuery, ...query }\n\n            await this.render(req, res, page, mergedQuery, parsedUrl)\n          },\n        })\n      }\n    }\n  }\n\n  async startWatcher() {\n    if (this.webpackWatcher) {\n      return\n    }\n\n    let resolved = false\n    return new Promise(resolve => {\n      const pagesDir = this.pagesDir\n\n      // Watchpack doesn't emit an event for an empty directory\n      fs.readdir(pagesDir!, (_, files) => {\n        if (files && files.length) {\n          return\n        }\n\n        if (!resolved) {\n          resolve()\n          resolved = true\n        }\n      })\n\n      let wp = (this.webpackWatcher = new Watchpack())\n      wp.watch([], [pagesDir!], 0)\n\n      wp.on('aggregated', () => {\n        const dynamicRoutedPages = []\n        const knownFiles = wp.getTimeInfoEntries()\n        for (const [fileName, { accuracy }] of knownFiles) {\n          if (accuracy === undefined) {\n            continue\n          }\n\n          let pageName =\n            '/' + relative(pagesDir!, fileName).replace(/\\\\+/g, '/')\n\n          pageName = pageName.replace(\n            new RegExp(`\\\\.+(?:${this.nextConfig.pageExtensions.join('|')})$`),\n            ''\n          )\n\n          pageName = pageName.replace(/\\/index$/, '') || '/'\n\n          if (!isDynamicRoute(pageName)) {\n            continue\n          }\n\n          dynamicRoutedPages.push(pageName)\n        }\n\n        this.dynamicRoutes = getSortedRoutes(dynamicRoutedPages).map(page => ({\n          page,\n          match: getRouteMatcher(getRouteRegex(page)),\n        }))\n\n        if (!resolved) {\n          resolve()\n          resolved = true\n        }\n      })\n    })\n  }\n\n  async stopWatcher() {\n    if (!this.webpackWatcher) {\n      return\n    }\n\n    this.webpackWatcher.close()\n    this.webpackWatcher = null\n  }\n\n  async prepare() {\n    await verifyTypeScriptSetup(this.dir, this.pagesDir!)\n\n    this.hotReloader = new HotReloader(this.dir, {\n      pagesDir: this.pagesDir!,\n      config: this.nextConfig,\n      buildId: this.buildId,\n    })\n    await super.prepare()\n    await this.addExportPathMapRoutes()\n    await this.hotReloader.start()\n    await this.startWatcher()\n    this.setDevReady!()\n\n    setTelemetryDir(this.distDir)\n    recordVersion({ cliCommand: 'dev' })\n  }\n\n  protected async close() {\n    await this.stopWatcher()\n    if (this.hotReloader) {\n      await this.hotReloader.stop()\n    }\n  }\n\n  async run(\n    req: IncomingMessage,\n    res: ServerResponse,\n    parsedUrl: UrlWithParsedQuery\n  ) {\n    await this.devReady\n    const { pathname } = parsedUrl\n\n    if (pathname!.startsWith('/_next')) {\n      try {\n        await fsStat(join(this.publicDir, '_next'))\n        throw new Error(PUBLIC_DIR_MIDDLEWARE_CONFLICT)\n      } catch (err) {}\n    }\n\n    // check for a public file, throwing error if there's a\n    // conflicting page\n    if (await this.hasPublicFile(pathname!)) {\n      const pageFile = await findPageFile(\n        this.pagesDir!,\n        normalizePagePath(pathname!),\n        this.nextConfig.pageExtensions\n      )\n\n      if (pageFile) {\n        const err = new Error(\n          `A conflicting public file and page file was found for path ${pathname} https://err.sh/zeit/next.js/conflicting-public-file-page`\n        )\n        res.statusCode = 500\n        return this.renderError(err, req, res, pathname!, {})\n      }\n      return this.servePublic(req, res, pathname!)\n    }\n\n    const { finished } = (await this.hotReloader!.run(req, res, parsedUrl)) || {\n      finished: false,\n    }\n    if (finished) {\n      return\n    }\n\n    return super.run(req, res, parsedUrl)\n  }\n\n  generateRoutes() {\n    const routes = super.generateRoutes()\n\n    // In development we expose all compiled files for react-error-overlay's line show feature\n    // We use unshift so that we're sure the routes is defined before Next's default routes\n    routes.unshift({\n      match: route('/_next/development/:path*'),\n      fn: async (req, res, params) => {\n        const p = join(this.distDir, ...(params.path || []))\n        await this.serveStatic(req, res, p)\n      },\n    })\n\n    return routes\n  }\n\n  // In development public files are not added to the router but handled as a fallback instead\n  protected generatePublicRoutes() {\n    return []\n  }\n\n  // In development dynamic routes cannot be known ahead of time\n  protected getDynamicRoutes() {\n    return []\n  }\n\n  _filterAmpDevelopmentScript(\n    html: string,\n    event: { line: number; col: number; code: string }\n  ) {\n    if (event.code !== 'DISALLOWED_SCRIPT_TAG') {\n      return true\n    }\n\n    const snippetChunks = html.split('\\n')\n\n    let snippet\n    if (\n      !(snippet = html.split('\\n')[event.line - 1]) ||\n      !(snippet = snippet.substring(event.col))\n    ) {\n      return true\n    }\n\n    snippet = snippet + snippetChunks.slice(event.line).join('\\n')\n    snippet = snippet.substring(0, snippet.indexOf('</script>'))\n\n    return !snippet.includes('data-amp-development-mode-only')\n  }\n\n  /**\n   * Check if resolver function is build or request new build for this function\n   * @param {string} pathname\n   */\n  protected async resolveApiRequest(pathname: string): Promise<string | null> {\n    try {\n      await this.hotReloader!.ensurePage(pathname)\n    } catch (err) {\n      // API route dosn't exist => return 404\n      if (err.code === 'ENOENT') {\n        return null\n      }\n    }\n    const resolvedPath = await super.resolveApiRequest(pathname)\n    return resolvedPath\n  }\n\n  async renderToHTML(\n    req: IncomingMessage,\n    res: ServerResponse,\n    pathname: string,\n    query: { [key: string]: string },\n    options = {}\n  ) {\n    const compilationErr = await this.getCompilationError(pathname)\n    if (compilationErr) {\n      res.statusCode = 500\n      return this.renderErrorToHTML(compilationErr, req, res, pathname, query)\n    }\n\n    // In dev mode we use on demand entries to compile the page before rendering\n    try {\n      await this.hotReloader!.ensurePage(pathname).catch(async (err: Error) => {\n        if ((err as any).code !== 'ENOENT') {\n          throw err\n        }\n\n        for (const dynamicRoute of this.dynamicRoutes || []) {\n          const params = dynamicRoute.match(pathname)\n          if (!params) {\n            continue\n          }\n\n          return this.hotReloader!.ensurePage(dynamicRoute.page).then(() => {\n            pathname = dynamicRoute.page\n            query = Object.assign({}, query, params)\n          })\n        }\n\n        throw err\n      })\n    } catch (err) {\n      if (err.code === 'ENOENT') {\n        res.statusCode = 404\n        return this.renderErrorToHTML(null, req, res, pathname, query)\n      }\n      if (!this.quiet) console.error(err)\n    }\n    const html = await super.renderToHTML(req, res, pathname, query, options)\n    return html\n  }\n\n  async renderErrorToHTML(\n    err: Error | null,\n    req: IncomingMessage,\n    res: ServerResponse,\n    pathname: string,\n    query: { [key: string]: string }\n  ) {\n    await this.hotReloader!.ensurePage('/_error')\n\n    const compilationErr = await this.getCompilationError(pathname)\n    if (compilationErr) {\n      res.statusCode = 500\n      return super.renderErrorToHTML(compilationErr, req, res, pathname, query)\n    }\n\n    if (!err && res.statusCode === 500) {\n      err = new Error(\n        'An undefined error was thrown sometime during render... ' +\n          'See https://err.sh/zeit/next.js/threw-undefined'\n      )\n    }\n\n    try {\n      const out = await super.renderErrorToHTML(err, req, res, pathname, query)\n      return out\n    } catch (err2) {\n      if (!this.quiet) Log.error(err2)\n      res.statusCode = 500\n      return super.renderErrorToHTML(err2, req, res, pathname, query)\n    }\n  }\n\n  sendHTML(req: IncomingMessage, res: ServerResponse, html: string) {\n    // In dev, we should not cache pages for any reason.\n    res.setHeader('Cache-Control', 'no-store, must-revalidate')\n    return super.sendHTML(req, res, html)\n  }\n\n  protected setImmutableAssetCacheControl(res: ServerResponse) {\n    res.setHeader('Cache-Control', 'no-store, must-revalidate')\n  }\n\n  servePublic(req: IncomingMessage, res: ServerResponse, path: string) {\n    const p = join(this.publicDir, path)\n    return this.serveStatic(req, res, p)\n  }\n\n  async hasPublicFile(path: string) {\n    try {\n      const info = await fsStat(join(this.publicDir, path))\n      return info.isFile()\n    } catch (_) {\n      return false\n    }\n  }\n\n  async getCompilationError(page: string) {\n    const errors = await this.hotReloader!.getCompilationErrors(page)\n    if (errors.length === 0) return\n\n    // Return the very first error we found.\n    return errors[0]\n  }\n}\n"],"mappings":"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","ignoreList":[]}