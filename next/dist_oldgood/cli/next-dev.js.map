{"version":3,"names":["exports","__esModule","nextDev","_path","require","_index","_interopRequireDefault","_fs","_startServer","_utils","_output","e","default","argv","args","arg","Boolean","Number","String","console","log","process","exit","dir","resolve","_","existsSync","printAndExit","port","appUrl","startedDevelopmentServer","startServer","dev","then","app","prepare","catch","err","code","errorMessage","pkgAppPath","sync","cwd","appPackage","scripts","nextScript","Object","entries","find","scriptLine","error","nextTick"],"sources":["next-dev.ts"],"sourcesContent":["#!/usr/bin/env node\nimport { resolve, join } from 'path'\nimport arg from 'next/dist/compiled/arg/index.js'\nimport { existsSync } from 'fs'\nimport startServer from '../server/lib/start-server'\nimport { printAndExit } from '../server/lib/utils'\nimport { startedDevelopmentServer } from '../build/output'\nimport { cliCommand } from '../bin/next'\n\nconst nextDev: cliCommand = argv => {\n  const args = arg(\n    {\n      // Types\n      '--help': Boolean,\n      '--port': Number,\n      '--hostname': String,\n\n      // Aliases\n      '-h': '--help',\n      '-p': '--port',\n      '-H': '--hostname',\n    },\n    { argv }\n  )\n\n  if (args['--help']) {\n    // tslint:disable-next-line\n    console.log(`\n      Description\n        Starts the application in development mode (hot-code reloading, error\n        reporting, etc)\n\n      Usage\n        $ next dev <dir> -p <port number>\n\n      <dir> represents where the compiled folder should go.\n      If no directory is provided, the folder will be created in the current directory.\n      You can set a custom folder in config https://github.com/zeit/next.js#custom-configuration.\n\n      Options\n        --port, -p      A port number on which to start the application\n        --hostname, -H  Hostname on which to start the application\n        --help, -h      Displays this message\n    `)\n    process.exit(0)\n  }\n\n  const dir = resolve(args._[0] || '.')\n\n  // Check if pages dir exists and warn if not\n  if (!existsSync(dir)) {\n    printAndExit(`> No such directory exists as the project root: ${dir}`)\n  }\n\n  const port = args['--port'] || 3000\n  const appUrl = `http://${args['--hostname'] || 'localhost'}:${port}`\n\n  startedDevelopmentServer(appUrl)\n\n  startServer({ dir, dev: true }, port, args['--hostname'])\n    .then(async app => {\n      await app.prepare()\n    })\n    .catch(err => {\n      if (err.code === 'EADDRINUSE') {\n        let errorMessage = `Port ${port} is already in use.`\n        const pkgAppPath = require('find-up').sync('package.json', {\n          cwd: dir,\n        })\n        const appPackage = require(pkgAppPath)\n        if (appPackage.scripts) {\n          const nextScript = Object.entries(appPackage.scripts).find(\n            scriptLine => scriptLine[1] === 'next'\n          )\n          if (nextScript) {\n            errorMessage += `\\nUse \\`npm run ${\n              nextScript[0]\n            } -- -p <some other port>\\`.`\n          }\n        }\n        // tslint:disable-next-line\n        console.error(errorMessage)\n      } else {\n        // tslint:disable-next-line\n        console.error(err)\n      }\n      process.nextTick(() => process.exit(1))\n    })\n}\n\nexport { nextDev }\n"],"mappings":"AAAA;AAAmB,aAAAA,OAAA,CAAAC,UAAA,MAAAD,OAAA,CAAAE,OAAA,QACnB,IAAAC,KAAA,CAAAC,OAAA,SACA,IAAAC,MAAA,CAAAC,sBAAA,CAAAF,OAAA,qCACA,IAAAG,GAAA,CAAAH,OAAA,OACA,IAAAI,YAAA,CAAAF,sBAAA,CAAAF,OAAA,gCACA,IAAAK,MAAA,CAAAL,OAAA,wBACA,IAAAM,OAAA,CAAAN,OAAA,oBAA0D,SAAAE,uBAAAK,CAAA,SAAAA,CAAA,EAAAA,CAAA,CAAAV,UAAA,CAAAU,CAAA,EAAAC,OAAA,CAAAD,CAAA,GAG1D,KAAM,CAAAT,OAAmB,CAAGW,IAAI,EAAI,CAClC,KAAM,CAAAC,IAAI,CAAG,GAAAC,cAAG,EACd,CACE;AACA,QAAQ,CAAEC,OAAO,CACjB,QAAQ,CAAEC,MAAM,CAChB,YAAY,CAAEC,MAAM,CAEpB;AACA,IAAI,CAAE,QAAQ,CACd,IAAI,CAAE,QAAQ,CACd,IAAI,CAAE,YACR,CAAC,CACD,CAAEL,IAAK,CACT,CAAC,CAED,GAAIC,IAAI,CAAC,QAAQ,CAAC,CAAE,CAClB;AACAK,OAAO,CAACC,GAAG,CAAC;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK,CAAC,CACFC,OAAO,CAACC,IAAI,CAAC,CAAC,CAAC,CACjB,CAEA,KAAM,CAAAC,GAAG,CAAG,GAAAC,aAAO,EAACV,IAAI,CAACW,CAAC,CAAC,CAAC,CAAC,EAAI,GAAG,CAAC,CAErC;AACA,GAAI,CAAC,GAAAC,cAAU,EAACH,GAAG,CAAC,CAAE,CACpB,GAAAI,mBAAY,EAAC,mDAAmDJ,GAAG,EAAE,CAAC,CACxE,CAEA,KAAM,CAAAK,IAAI,CAAGd,IAAI,CAAC,QAAQ,CAAC,EAAI,IAAI,CACnC,KAAM,CAAAe,MAAM,CAAG,UAAUf,IAAI,CAAC,YAAY,CAAC,EAAI,WAAW,IAAIc,IAAI,EAAE,CAEpE,GAAAE,gCAAwB,EAACD,MAAM,CAAC,CAEhC,GAAAE,oBAAW,EAAC,CAAER,GAAG,CAAES,GAAG,CAAE,IAAK,CAAC,CAAEJ,IAAI,CAAEd,IAAI,CAAC,YAAY,CAAC,CAAC,CACtDmB,IAAI,CAAC,KAAM,CAAAC,GAAG,EAAI,CACjB,KAAM,CAAAA,GAAG,CAACC,OAAO,CAAC,CAAC,CACrB,CAAC,CAAC,CACDC,KAAK,CAACC,GAAG,EAAI,CACZ,GAAIA,GAAG,CAACC,IAAI,GAAK,YAAY,CAAE,CAC7B,GAAI,CAAAC,YAAY,CAAG,QAAQX,IAAI,qBAAqB,CACpD,KAAM,CAAAY,UAAU,CAAGpC,OAAO,CAAC,SAAS,CAAC,CAACqC,IAAI,CAAC,cAAc,CAAE,CACzDC,GAAG,CAAEnB,GACP,CAAC,CAAC,CACF,KAAM,CAAAoB,UAAU,CAAGvC,OAAO,CAACoC,UAAU,CAAC,CACtC,GAAIG,UAAU,CAACC,OAAO,CAAE,CACtB,KAAM,CAAAC,UAAU,CAAGC,MAAM,CAACC,OAAO,CAACJ,UAAU,CAACC,OAAO,CAAC,CAACI,IAAI,CACxDC,UAAU,EAAIA,UAAU,CAAC,CAAC,CAAC,GAAK,MAClC,CAAC,CACD,GAAIJ,UAAU,CAAE,CACdN,YAAY,EAAI,mBACdM,UAAU,CAAC,CAAC,CAAC,6BACc,CAC/B,CACF,CACA;AACA1B,OAAO,CAAC+B,KAAK,CAACX,YAAY,CAAC,CAC7B,CAAC,IAAM,CACL;AACApB,OAAO,CAAC+B,KAAK,CAACb,GAAG,CAAC,CACpB,CACAhB,OAAO,CAAC8B,QAAQ,CAAC,IAAM9B,OAAO,CAACC,IAAI,CAAC,CAAC,CAAC,CAAC,CACzC,CAAC,CAAC,CACN,CAAC,CAAAtB,OAAA,CAAAE,OAAA,CAAAA,OAAA","ignoreList":[]}