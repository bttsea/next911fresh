{"version":3,"names":["eventCallbacks","EventSourceWrapper","options","source","lastActivity","Date","listeners","timeout","init","timer","setInterval","handleDisconnect","window","EventSource","path","onopen","handleOnline","onerror","onmessage","handleMessage","log","console","event","i","length","data","indexOf","forEach","cb","clearInterval","close","setTimeout","clearTimeout","addMessageListener","fn","push","getEventSourceWrapper","ondemand"],"sources":["eventsource.js"],"sourcesContent":["const eventCallbacks = []\n\nfunction EventSourceWrapper (options) {\n  var source\n  var lastActivity = new Date()\n  var listeners = []\n\n  if (!options.timeout) {\n    options.timeout = 20 * 1000\n  }\n\n  init()\n  var timer = setInterval(function () {\n    if (new Date() - lastActivity > options.timeout) {\n      handleDisconnect()\n    }\n  }, options.timeout / 2)\n\n  function init () {\n    source = new window.EventSource(options.path)\n    source.onopen = handleOnline\n    source.onerror = handleDisconnect\n    source.onmessage = handleMessage\n  }\n\n  function handleOnline () {\n    if (options.log) console.log('[HMR] connected')\n    lastActivity = new Date()\n  }\n\n  function handleMessage (event) {\n    lastActivity = new Date()\n    for (var i = 0; i < listeners.length; i++) {\n      listeners[i](event)\n    }\n    if (event.data.indexOf('action') !== -1) {\n      eventCallbacks.forEach(cb => cb(event))\n    }\n  }\n\n  function handleDisconnect () {\n    clearInterval(timer)\n    source.close()\n    setTimeout(init, options.timeout)\n  }\n\n  return {\n    close: () => {\n      clearTimeout(timer)\n      source.close()\n    },\n    addMessageListener: function (fn) {\n      listeners.push(fn)\n    }\n  }\n}\n\nexport function getEventSourceWrapper (options) {\n  if (!options.ondemand) {\n    return {\n      addMessageListener: cb => {\n        eventCallbacks.push(cb)\n      }\n    }\n  }\n  return EventSourceWrapper(options)\n}\n"],"mappings":"yFAAA,KAAM,CAAAA,cAAc,CAAG,EAAE,CAEzB,QAAS,CAAAC,kBAAkBA,CAAEC,OAAO,CAAE,CACpC,GAAI,CAAAC,MAAM,CACV,GAAI,CAAAC,YAAY,CAAG,GAAI,CAAAC,IAAI,CAAC,CAAC,CAC7B,GAAI,CAAAC,SAAS,CAAG,EAAE,CAElB,GAAI,CAACJ,OAAO,CAACK,OAAO,CAAE,CACpBL,OAAO,CAACK,OAAO,CAAG,EAAE,CAAG,IAAI,CAC7B,CAEAC,IAAI,CAAC,CAAC,CACN,GAAI,CAAAC,KAAK,CAAGC,WAAW,CAAC,UAAY,CAClC,GAAI,GAAI,CAAAL,IAAI,CAAC,CAAC,CAAGD,YAAY,CAAGF,OAAO,CAACK,OAAO,CAAE,CAC/CI,gBAAgB,CAAC,CAAC,CACpB,CACF,CAAC,CAAET,OAAO,CAACK,OAAO,CAAG,CAAC,CAAC,CAEvB,QAAS,CAAAC,IAAIA,CAAA,CAAI,CACfL,MAAM,CAAG,GAAI,CAAAS,MAAM,CAACC,WAAW,CAACX,OAAO,CAACY,IAAI,CAAC,CAC7CX,MAAM,CAACY,MAAM,CAAGC,YAAY,CAC5Bb,MAAM,CAACc,OAAO,CAAGN,gBAAgB,CACjCR,MAAM,CAACe,SAAS,CAAGC,aAAa,CAClC,CAEA,QAAS,CAAAH,YAAYA,CAAA,CAAI,CACvB,GAAId,OAAO,CAACkB,GAAG,CAAEC,OAAO,CAACD,GAAG,CAAC,iBAAiB,CAAC,CAC/ChB,YAAY,CAAG,GAAI,CAAAC,IAAI,CAAC,CAAC,CAC3B,CAEA,QAAS,CAAAc,aAAaA,CAAEG,KAAK,CAAE,CAC7BlB,YAAY,CAAG,GAAI,CAAAC,IAAI,CAAC,CAAC,CACzB,IAAK,GAAI,CAAAkB,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAGjB,SAAS,CAACkB,MAAM,CAAED,CAAC,EAAE,CAAE,CACzCjB,SAAS,CAACiB,CAAC,CAAC,CAACD,KAAK,CAAC,CACrB,CACA,GAAIA,KAAK,CAACG,IAAI,CAACC,OAAO,CAAC,QAAQ,CAAC,GAAK,CAAC,CAAC,CAAE,CACvC1B,cAAc,CAAC2B,OAAO,CAACC,EAAE,EAAIA,EAAE,CAACN,KAAK,CAAC,CAAC,CACzC,CACF,CAEA,QAAS,CAAAX,gBAAgBA,CAAA,CAAI,CAC3BkB,aAAa,CAACpB,KAAK,CAAC,CACpBN,MAAM,CAAC2B,KAAK,CAAC,CAAC,CACdC,UAAU,CAACvB,IAAI,CAAEN,OAAO,CAACK,OAAO,CAAC,CACnC,CAEA,MAAO,CACLuB,KAAK,CAAEA,CAAA,GAAM,CACXE,YAAY,CAACvB,KAAK,CAAC,CACnBN,MAAM,CAAC2B,KAAK,CAAC,CAAC,CAChB,CAAC,CACDG,kBAAkB,CAAE,QAAAA,CAAUC,EAAE,CAAE,CAChC5B,SAAS,CAAC6B,IAAI,CAACD,EAAE,CAAC,CACpB,CACF,CAAC,CACH,CAEO,QAAS,CAAAE,qBAAqBA,CAAElC,OAAO,CAAE,CAC9C,GAAI,CAACA,OAAO,CAACmC,QAAQ,CAAE,CACrB,MAAO,CACLJ,kBAAkB,CAAEL,EAAE,EAAI,CACxB5B,cAAc,CAACmC,IAAI,CAACP,EAAE,CAAC,CACzB,CACF,CAAC,CACH,CACA,MAAO,CAAA3B,kBAAkB,CAACC,OAAO,CAAC,CACpC","ignoreList":[]}