{"version":3,"names":["_unfetch","_interopRequireDefault","require","_eventsource","e","__esModule","default","evtSource","currentPage","exports","closePing","close","setupPing","assetPrefix","pathnameFn","retry","pathname","url","getEventSourceWrapper","path","timeout","ondemand","addMessageListener","event","data","indexOf","payload","JSON","parse","invalid","fetch","location","href","credentials","then","pageRes","status","reload","err","console","error"],"sources":["on-demand-entries-utils.js"],"sourcesContent":["/* global window, location */\n\nimport fetch from 'unfetch'\nimport { getEventSourceWrapper } from './error-overlay/eventsource'\n\nlet evtSource\nexport let currentPage\n\nexport function closePing () {\n  if (evtSource) evtSource.close()\n  evtSource = null\n}\n\nexport function setupPing (assetPrefix, pathnameFn, retry) {\n  const pathname = pathnameFn()\n\n  // Make sure to only create new EventSource request if page has changed\n  if (pathname === currentPage && !retry) return\n  currentPage = pathname\n  // close current EventSource connection\n  closePing()\n\n  const url = `${assetPrefix}/_next/webpack-hmr?page=${currentPage}`\n  evtSource = getEventSourceWrapper({ path: url, timeout: 5000, ondemand: 1 })\n\n  evtSource.addMessageListener(event => {\n    if (event.data.indexOf('{') === -1) return\n    try {\n      const payload = JSON.parse(event.data)\n      if (payload.invalid) {\n        // Payload can be invalid even if the page does not exist.\n        // So, we need to make sure it exists before reloading.\n        fetch(location.href, {\n          credentials: 'same-origin'\n        }).then(pageRes => {\n          if (pageRes.status === 200) {\n            location.reload()\n          }\n        })\n      }\n    } catch (err) {\n      console.error('on-demand-entries failed to parse response', err)\n    }\n  })\n}\n"],"mappings":"wHAEA,IAAAA,QAAA,CAAAC,sBAAA,CAAAC,OAAA,aACA,IAAAC,YAAA,CAAAD,OAAA,gCAAmE,SAAAD,uBAAAG,CAAA,SAAAA,CAAA,EAAAA,CAAA,CAAAC,UAAA,CAAAD,CAAA,EAAAE,OAAA,CAAAF,CAAA,GAHnE,6BAKA,GAAI,CAAAG,SAAS,CACN,GAAI,CAAAC,WAAW,CAAAC,OAAA,CAAAD,WAAA,QAEf,QAAS,CAAAE,SAASA,CAAA,CAAI,CAC3B,GAAIH,SAAS,CAAEA,SAAS,CAACI,KAAK,CAAC,CAAC,CAChCJ,SAAS,CAAG,IAAI,CAClB,CAEO,QAAS,CAAAK,SAASA,CAAEC,WAAW,CAAEC,UAAU,CAAEC,KAAK,CAAE,CACzD,KAAM,CAAAC,QAAQ,CAAGF,UAAU,CAAC,CAAC,CAE7B;AACA,GAAIE,QAAQ,GAAKR,WAAW,EAAI,CAACO,KAAK,CAAE,OACxCN,OAAA,CAAAD,WAAA,CAAAA,WAAW,CAAGQ,QAAQ,CACtB;AACAN,SAAS,CAAC,CAAC,CAEX,KAAM,CAAAO,GAAG,CAAG,GAAGJ,WAAW,2BAA2BL,WAAW,EAAE,CAClED,SAAS,CAAG,GAAAW,kCAAqB,EAAC,CAAEC,IAAI,CAAEF,GAAG,CAAEG,OAAO,CAAE,IAAI,CAAEC,QAAQ,CAAE,CAAE,CAAC,CAAC,CAE5Ed,SAAS,CAACe,kBAAkB,CAACC,KAAK,EAAI,CACpC,GAAIA,KAAK,CAACC,IAAI,CAACC,OAAO,CAAC,GAAG,CAAC,GAAK,CAAC,CAAC,CAAE,OACpC,GAAI,CACF,KAAM,CAAAC,OAAO,CAAGC,IAAI,CAACC,KAAK,CAACL,KAAK,CAACC,IAAI,CAAC,CACtC,GAAIE,OAAO,CAACG,OAAO,CAAE,CACnB;AACA;AACA,GAAAC,gBAAK,EAACC,QAAQ,CAACC,IAAI,CAAE,CACnBC,WAAW,CAAE,aACf,CAAC,CAAC,CAACC,IAAI,CAACC,OAAO,EAAI,CACjB,GAAIA,OAAO,CAACC,MAAM,GAAK,GAAG,CAAE,CAC1BL,QAAQ,CAACM,MAAM,CAAC,CAAC,CACnB,CACF,CAAC,CAAC,CACJ,CACF,CAAE,MAAOC,GAAG,CAAE,CACZC,OAAO,CAACC,KAAK,CAAC,4CAA4C,CAAEF,GAAG,CAAC,CAClE,CACF,CAAC,CAAC,CACJ","ignoreList":[]}