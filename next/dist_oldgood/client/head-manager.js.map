{"version":3,"names":["DOMAttributeNames","acceptCharset","className","htmlFor","httpEquiv","HeadManager","constructor","updateHead","head","promise","updatePromise","Promise","resolve","then","doUpdateHead","tags","forEach","h","components","type","push","updateTitle","title","types","updateElements","component","children","props","join","document","headEl","getElementsByTagName","headCountEl","querySelector","process","env","NODE_ENV","console","error","headCount","Number","content","oldTags","i","j","previousElementSibling","tagName","toLowerCase","newTags","map","reactElementToDOM","filter","newTag","k","len","length","oldTag","isEqualNode","splice","t","parentNode","removeChild","insertBefore","toString","exports","default","el","createElement","p","hasOwnProperty","attr","setAttribute","dangerouslySetInnerHTML","innerHTML","__html","textContent"],"sources":["head-manager.js"],"sourcesContent":["const DOMAttributeNames = {\n  acceptCharset: 'accept-charset',\n  className: 'class',\n  htmlFor: 'for',\n  httpEquiv: 'http-equiv'\n}\n\nexport default class HeadManager {\n  constructor () {\n    this.updatePromise = null\n  }\n\n  updateHead = head => {\n    const promise = (this.updatePromise = Promise.resolve().then(() => {\n      if (promise !== this.updatePromise) return\n\n      this.updatePromise = null\n      this.doUpdateHead(head)\n    }))\n  }\n\n  doUpdateHead (head) {\n    const tags = {}\n    head.forEach(h => {\n      const components = tags[h.type] || []\n      components.push(h)\n      tags[h.type] = components\n    })\n\n    this.updateTitle(tags.title ? tags.title[0] : null)\n\n    const types = ['meta', 'base', 'link', 'style', 'script']\n    types.forEach(type => {\n      this.updateElements(type, tags[type] || [])\n    })\n  }\n\n  updateTitle (component) {\n    let title = ''\n    if (component) {\n      const { children } = component.props\n      title = typeof children === 'string' ? children : children.join('')\n    }\n    if (title !== document.title) document.title = title\n  }\n\n  updateElements (type, components) {\n    const headEl = document.getElementsByTagName('head')[0]\n    const headCountEl = headEl.querySelector('meta[name=next-head-count]')\n    if (process.env.NODE_ENV !== 'production') {\n      if (!headCountEl) {\n        console.error(\n          'Warning: next-head-count is missing. https://err.sh/next.js/next-head-count-missing'\n        )\n        return\n      }\n    }\n\n    const headCount = Number(headCountEl.content)\n    const oldTags = []\n\n    for (\n      let i = 0, j = headCountEl.previousElementSibling;\n      i < headCount;\n      i++, j = j.previousElementSibling\n    ) {\n      if (j.tagName.toLowerCase() === type) {\n        oldTags.push(j)\n      }\n    }\n    const newTags = components.map(reactElementToDOM).filter(newTag => {\n      for (let k = 0, len = oldTags.length; k < len; k++) {\n        const oldTag = oldTags[k]\n        if (oldTag.isEqualNode(newTag)) {\n          oldTags.splice(k, 1)\n          return false\n        }\n      }\n      return true\n    })\n\n    oldTags.forEach(t => t.parentNode.removeChild(t))\n    newTags.forEach(t => headEl.insertBefore(t, headCountEl))\n    headCountEl.content = (\n      headCount -\n      oldTags.length +\n      newTags.length\n    ).toString()\n  }\n}\n\nfunction reactElementToDOM ({ type, props }) {\n  const el = document.createElement(type)\n  for (const p in props) {\n    if (!props.hasOwnProperty(p)) continue\n    if (p === 'children' || p === 'dangerouslySetInnerHTML') continue\n\n    const attr = DOMAttributeNames[p] || p.toLowerCase()\n    el.setAttribute(attr, props[p])\n  }\n\n  const { children, dangerouslySetInnerHTML } = props\n  if (dangerouslySetInnerHTML) {\n    el.innerHTML = dangerouslySetInnerHTML.__html || ''\n  } else if (children) {\n    el.textContent = typeof children === 'string' ? children : children.join('')\n  }\n  return el\n}\n"],"mappings":"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","ignoreList":[]}