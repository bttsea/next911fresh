{"version":3,"names":["_react","_interopRequireDefault","require","_router2","_interopRequireWildcard","exports","Router","default","NextRouter","_routerContext","_withRouter","withRouter","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","singletonRouter","router","readyCallbacks","ready","cb","window","push","urlPropertyFields","routerEvents","coreMethodFields","events","forEach","field","getRouter","args","event","on","eventField","charAt","toUpperCase","substring","_singletonRouter","err","console","error","message","stack","Error","_default","useRouter","React","useContext","RouterContext","createRouter","makePublicRouterInstance","_router","instance","property"],"sources":["router.ts"],"sourcesContent":["/* global window */\nimport React from 'react'\nimport Router, { NextRouter } from '../next-server/lib/router/router'\nimport { RouterContext } from '../next-server/lib/router-context'\n\ntype ClassArguments<T> = T extends new (...args: infer U) => any ? U : any\n\ntype RouterArgs = ClassArguments<typeof Router>\n\ntype SingletonRouterBase = {\n  router: Router | null\n  readyCallbacks: Array<() => any>\n  ready(cb: () => any): void\n}\n\nexport { Router, NextRouter }\n\nexport type SingletonRouter = SingletonRouterBase & NextRouter\n\nconst singletonRouter: SingletonRouterBase = {\n  router: null, // holds the actual router instance\n  readyCallbacks: [],\n  ready(cb: () => void) {\n    if (this.router) return cb()\n    if (typeof window !== 'undefined') {\n      this.readyCallbacks.push(cb)\n    }\n  },\n}\n\n// Create public properties and methods of the router in the singletonRouter\nconst urlPropertyFields = ['pathname', 'route', 'query', 'asPath', 'components']\nconst routerEvents = [\n  'routeChangeStart',\n  'beforeHistoryChange',\n  'routeChangeComplete',\n  'routeChangeError',\n  'hashChangeStart',\n  'hashChangeComplete',\n]\nconst coreMethodFields = [\n  'push',\n  'replace',\n  'reload',\n  'back',\n  'prefetch',\n  'beforePopState',\n]\n\n// Events is a static property on the router, the router doesn't have to be initialized to use it\nObject.defineProperty(singletonRouter, 'events', {\n  get() {\n    return Router.events\n  },\n})\n\nurlPropertyFields.forEach(field => {\n  // Here we need to use Object.defineProperty because, we need to return\n  // the property assigned to the actual router\n  // The value might get changed as we change routes and this is the\n  // proper way to access it\n  Object.defineProperty(singletonRouter, field, {\n    get() {\n      const router = getRouter() as any\n      return router[field] as string\n    },\n  })\n})\n\ncoreMethodFields.forEach(field => {\n  // We don't really know the types here, so we add them later instead\n  ;(singletonRouter as any)[field] = (...args: any[]) => {\n    const router = getRouter() as any\n    return router[field](...args)\n  }\n})\n\nrouterEvents.forEach(event => {\n  singletonRouter.ready(() => {\n    Router.events.on(event, (...args) => {\n      const eventField = `on${event.charAt(0).toUpperCase()}${event.substring(\n        1\n      )}`\n      const _singletonRouter = singletonRouter as any\n      if (_singletonRouter[eventField]) {\n        try {\n          _singletonRouter[eventField](...args)\n        } catch (err) {\n          // tslint:disable-next-line:no-console\n          console.error(`Error when running the Router event: ${eventField}`)\n          // tslint:disable-next-line:no-console\n          console.error(`${err.message}\\n${err.stack}`)\n        }\n      }\n    })\n  })\n})\n\nfunction getRouter() {\n  if (!singletonRouter.router) {\n    const message =\n      'No router instance found.\\n' +\n      'You should only use \"next/router\" inside the client side of your app.\\n'\n    throw new Error(message)\n  }\n  return singletonRouter.router\n}\n\n// Export the singletonRouter and this is the public API.\nexport default singletonRouter as SingletonRouter\n\n// Reexport the withRoute HOC\nexport { default as withRouter } from './with-router'\n\nexport function useRouter() {\n  return React.useContext(RouterContext)\n}\n\n// INTERNAL APIS\n// -------------\n// (do not use following exports inside the app)\n\n// Create a router and assign it as the singleton instance.\n// This is used in client side when we are initilizing the app.\n// This should **not** use inside the server.\nexport const createRouter = (...args: RouterArgs) => {\n  singletonRouter.router = new Router(...args)\n  singletonRouter.readyCallbacks.forEach(cb => cb())\n  singletonRouter.readyCallbacks = []\n\n  return singletonRouter.router\n}\n\n// This function is used to create the `withRouter` router instance\nexport function makePublicRouterInstance(router: Router): NextRouter {\n  const _router = router as any\n  const instance = {} as any\n\n  for (const property of urlPropertyFields) {\n    if (typeof _router[property] === 'object') {\n      instance[property] = { ..._router[property] } // makes sure query is not stateful\n      continue\n    }\n\n    instance[property] = _router[property]\n  }\n\n  // Events is a static property on the router, the router doesn't have to be initialized to use it\n  instance.events = Router.events\n\n  coreMethodFields.forEach(field => {\n    instance[field] = (...args: any[]) => {\n      return _router[field](...args)\n    }\n  })\n\n  return instance\n}\n"],"mappings":"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","ignoreList":[]}